let e=/ on([a-z]+)\s*=\s*(["'])?\s*?$/,t={"'":/^\s*'/,'"':/^\s*"/},r="data-kata-ev",o=/^data-kata-embed:(\d+)$/;export default function(n,...a){let l=[],c=[],d="",i=Array.from(n);for(let o of a)if("function"==typeof o)d+=i.shift().replace(e,(e,n,a)=>{let l=c.push({event:n,handler:o})-1;return a&&i[0]&&(i[0]=i[0].replace(t[a],"")),` ${r}="${l}"`});else{d+=i.shift();for(let e of[].concat(o))if("object"==typeof e&&"number"==typeof e.nodeType&&[1,3,8,11].includes(e.nodeType)){d+=`\x3c!--data-kata-embed:${l.push(e)-1}--\x3e`}else d+=e}d+=i.shift();let f=document.createRange().createContextualFragment(d.trim());return f.querySelectorAll(`*[${r}]`).forEach(e=>{let t=c[e.getAttribute(r)];e.addEventListener(t.event,t.handler),e.removeAttribute(r)}),function(e,t){let r,n,a=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT,{acceptNode:function(e){if(r=e.textContent.match(o))return NodeFilter.FILTER_ACCEPT}});for(;n=a.nextNode();)console.log("replacing",n,"with",r[1]),n.replaceWith(t[r[1]])}(f,l),1==f.childNodes.length?f.firstChild:f};
