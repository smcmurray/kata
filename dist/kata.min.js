let e=/ on([a-z]+)\s*=\s*(["'])?\s*?$/,t={"'":/^\s*'/,'"':/^\s*"/},r="data-kata-ev",o=/^data-kata-embed:(\d+)$/;export default function(a,...n){let l=[],f=[],d="",c=Array.from(a);for(let o of n)if("function"==typeof o)d+=c.shift().replace(e,(e,a,n)=>{let l=f.push({event:a,handler:o})-1;return n&&c[0]&&(c[0]=c[0].replace(t[n],"")),` ${r}-${a}="${l}"`});else{d+=c.shift();for(let e of[].concat(o))if("object"==typeof e&&"number"==typeof e.nodeType&&[1,3,8,11].includes(e.nodeType)){d+=`\x3c!--data-kata-embed:${l.push(e)-1}--\x3e`}else d+=e}d+=c.shift();let i=document.createRange().createContextualFragment(d.trim());for(let e of new Set(f.map(e=>e.event)))for(let t of Array.from(i.querySelectorAll(`*[${r}-${e}]`))){let o=f[t.getAttribute(`${r}-${e}`)];t.addEventListener(o.event,o.handler),t.removeAttribute(`${r}-${e}`)}let u,s,p=document.createNodeIterator(i,NodeFilter.SHOW_COMMENT,{acceptNode:function(e){if(u=e.textContent.match(o))return NodeFilter.FILTER_ACCEPT}});for(;s=p.nextNode();)s.replaceWith(l[u[1]]);return 1==i.childNodes.length?i.firstChild:i};
