let e=/ on([a-z]+)\s*=\s*(["'])?\s*?$/,t={"'":/^\s*'/,'"':/^\s*"/},r="data-kata-ev",a=/^data-kata-embed:(\d+)$/;export default function(o,...n){let l=[],d=[],c="",f=Array.from(o);for(let a of n)if("function"==typeof a)c+=f.shift().replace(e,(e,o,n)=>{let l=d.push({event:o,handler:a})-1;return n&&f[0]&&(f[0]=f[0].replace(t[n],"")),` ${r}="${l}"`});else{c+=f.shift();for(let e of[].concat(a))if("object"==typeof e&&"number"==typeof e.nodeType&&[1,3,8,11].includes(e.nodeType)){c+=`\x3c!--data-kata-embed:${l.push(e)-1}--\x3e`}else c+=e}c+=f.shift();let i=document.createRange().createContextualFragment(c.trim());i.querySelectorAll(`*[${r}]`).forEach(e=>{let t=d[e.getAttribute(r)];e.addEventListener(t.event,t.handler),e.removeAttribute(r)});let u,s,h=document.createNodeIterator(i,NodeFilter.SHOW_COMMENT,{acceptNode:function(e){if(u=e.textContent.match(a))return NodeFilter.FILTER_ACCEPT}});for(;s=h.nextNode();)s.replaceWith(l[u[1]]);return 1==i.childNodes.length?i.firstChild:i};
