!function(e,r){"undefined"!=typeof module?module.exports=r():"function"==typeof define&&"object"==typeof define.amd?define(r()):this[e]=r()}("kata",function(){function e(e){var r,t=/^\s*\(/g,n="",i=0;if(/^\s*\(/.test(e)){for(t=/\s*((?:(?!\{\{|\(|\)|\}\})[\s\S])*?)(\(|\))/g;r=t.exec(e);)if("("===r[2]?i+=1:i-=1,n+=(r[1]?r[1]:"")+r[2],!i)return{pos:t.lastIndex,value:n};throw new Error("Parenthetical missing )")}}var r,t={},n={src:!1,plugins:{}};return r=Object.create(Object.prototype,{parse:{value:function(e){if(this.parsed)throw new Error("Attempting to reparse "+this.symbol+" block");e&&/\S/.test(e)&&this.addChild("c").parse(e).render(),this.parsed=!0}},end:{value:null,writable:!0},addChild:{value:function(e,r){var i,s,a;if(!(a=t[e||"="])&&(s=/^#(\w+)/,!(i=s.exec(e))||!(a=n.plugins[i[1]()])))throw new Error("Unknown block type: "+e);this.children||(this.children=[]);var o=this.children.push(Object.create(a,{start:{value:r||0}}));return this.children[o-1]}},render:{value:function(){return this.children?this.children.reduce(function(e,r){return e+r.rendered},""):""}}}),t.root=Object.create(r,{parsed:{value:!0},addChild:{value:function(e,t){if(this.children)throw new Error("Unexpected content after template definition");if("%"!=e)throw new Error("Expected Template block. Templates must begin with {{% ( not "+e+")");return r.addChild.call(this,e,t)}},render:{value:function(){if(!this.children)throw new Error("No template defined");return this.children[0].rendered}}}),t["%"]=Object.create(r,{symbol:{value:"%"},name:{value:null,writable:!0},args:{value:null,writable:!0},parse:{value:function(t){var n,i=/^\s*(\w+)/g;if((n=i.exec(t))&&(this.name=n[1],this.end+=i.lastIndex,t=t.substr(i.lastIndex)),!(n=e(t)))throw new Error("Template block missing arguments at position "+this.end);return this.args=n.value,this.end+=n.pos,r.parse.call(this,t.substr(n.pos)),this}},render:{value:function(){return this.rendered||(this.rendered="function "+(this.name?this.name:"")+this.args+"{var out='';"+r.render.call(this)+"return out;}"),this.rendered}},addChild:{value:function(e,t){if(":"===e)throw new Error("Template blocks cannot contain Elseif blocks directly");return r.addChild.call(this,e,t)}}}),t["="]=Object.create(r,{symbol:{value:"="},parse:{value:function(e){return this.expr=e.replace(/"/g,'\\"').replace(/\r|\n/g,"\\n"),r.parse.call(this),this}},render:{value:function(){return this.rendered||(this.rendered="out += ("+(this.expr?this.expr:"")+");"),this.rendered}},addChild:{value:function(){throw new Error("Interpolate blocks cannot contain other blocks")}}}),t["@"]=Object.create(r,{symbol:{value:"@"},parse:{value:function(t){var n;if(!(n=e(t)))throw new Error("Iterate block missing iterable");if(this.iter=n.value,t=t.substr(n.pos),!(n=e(t)))throw new Error("Iterate block missing arguments");return this.args=n.value,r.parse.call(this,t.substr(n.pos)),this}},render:{value:function(){return this.rendered||(this.rendered=this.iter+".forEach(function"+this.args+"{"+r.render.call(this)+"});"),this.rendered}},addChild:{value:function(e,t){if(":"===e)throw new Error("Iterate blocks cannot contain Elseif blocks directly");return r.addChild.call(this,e,t)}}}),t["?"]=Object.create(r,{symbol:{value:"?"},parse:{value:function(t){var n;if(!(n=e(t)))throw new Error("Condition block missing condition");return this.cond=n.value,r.parse.call(this,t.substr(n.pos)),this}},render:{value:function(){return this.rendered||(this.rendered="if "+this.cond+"{"+r.render.call(this)+"}"),this.rendered}}}),t[":"]=Object.create(r,{symbol:{value:":"},parse:{value:function(t){var n;return(n=e(t))&&(this.cond=n.value,t=t.substr(n.pos)),r.parse.call(this,t),this}},render:{value:function(){return this.rendered||(this.rendered="} else "+(this.cond?"if "+this.cond:"")+"{"+r.render.call(this)),this.rendered}}}),t["+"]=Object.create(r,{symbol:{value:"+"},parse:{value:function(t){var n,i=/^\s*(\w+)/g;if(!(n=i.exec(t)))throw new Error("Import block missing alias");if(this.alias=n[1],t=t.substr(i.lastIndex),!(n=e(t)))throw new Error("Import block missing template location");return this.location=n.value,t=t.substr(n.pos),r.parse.call(this,t),this}},render:{value:function(){return this.rendered||(this.rendered="var "+this.alias+" = require"+this.location+";"),this.rendered}},addChild:{value:function(){throw new Error("Import blocks cannot contain other blocks.")}}}),t[">"]=Object.create(r,{symbol:{value:"<"},parse:{value:function(t){var n,i=/^\s*(\w+)/g;if(!(n=i.exec(t)))throw new Error("Invoke block missing template name");if(this.signature=n[1],this.end+=i.lastIndex,t=t.substr(i.lastIndex),!(n=e(t)))throw new Error("Invoke block missing ()");return this.signature+=n.value,this.end+=n.pos,r.parse.call(this,t.substr(n.pos)),this}},render:{value:function(){return this.rendered||(this.rendered="out+=(function(){"+r.render.call(this)+"return "+this.signature+";}());"),this.rendered}},addChild:{value:function(e,t){if("%"!=e)throw new Error("Invoke blocks can only contain Template blocks,");return r.addChild.call(this,e,t)}}}),t["<"]=Object.create(r,{symbol:{value:">"},parse:{value:function(t){var n,i=/^\s*(\w+)/g;if(!(n=i.exec(t)))throw new Error("Yield block missing template name");if(this.target=n[1],t=t.substr(i.lastIndex),!(n=e(t)))throw new Error("Yield block missing ()");return this.args=n.value,t=t.substr(n.pos),r.parse.call(this,t),this}},render:{value:function(){return this.rendered||(this.rendered="if (typeof "+target+' ==="function") out+='+this.target+this.args+"; else {"+r.render.call(this)+"}"),this.rendered}}}),t["!"]=Object.create(r,{symbol:{value:"!"},parse:{value:function(e){return this.expr=e,r.parse.call(this),this}},render:{value:function(){return this.rendered||(this.rendered=this.expr),this.rendered}},addChild:{value:function(){throw new Error("Evaluate blocks cannot contain other blocks")}}}),t.c=Object.create(r,{symbol:{value:"c"},parse:{value:function(e){return this.expr=e.replace(/"/g,'\\"').replace(/\r|\n/g,"\\n"),r.parse.call(this),this.end=this.start+e.length,this}},render:{value:function(){return this.rendered||(this.rendered='out+="'+this.expr+'";'),this.rendered}}}),function(e,r){var i,s=Object.create(t.root,{start:{value:0}}),a=s,o=[s],l=/((?:(?!\{\{(?:[%@\?:\+><!]|#\w+)?|[%@\?:\+><!#]?\}\})[\s\S])*)(\{\{(?:[%@\?:\+><!]|#\w+)?|[%@\?:\+><!#]?\}\})/g;for(r&&Object.keys(n).forEach(function(e){r.hasOwnProperty(e)&&(n[e]=r[e])});o.length&&(i=l.exec(e));){if(i[1]&&i[1].length&&(a.parsed?a.addChild("c",i.index).parse(i[1]).render():a.parse(i[1])),"{{"===i[2].substr(0,2))o.push(a.addChild(i[2].substr(2),l.lastIndex-i[2].length));else{if("root"===a.symbol)throw new Error("Expecting {{% but found "+i[2]+" at position "+(l.lastIndex-i[2].length));if(sym=3===i[2].length?i[2].substr(0,1):this.symbol,sym&&sym!=a.symbol)throw new Error("{{"+a.symbol+" at position "+a.start+" does not match "+sym+"}} at position "+(l.lastIndex-3));a.e=l.lastIndex,a.render(),o.pop()}a=o[o.length-1]}if(a!==s)throw new Error("Failed to find end of {{"+a.sym+" block begun at position "+a.s+"\nq has "+o.length+" items");return n.src?"(function(name, definition){  'use strict';  if (typeof module != 'undefined') {    module.exports = definition(require);  }  else if (typeof define == 'function' && typeof define.amd == 'object') {    define(definition);  }  else this[name] = definition();}('template', function(require){ return "+s.render()+"}));":new Function("return "+s.render())()}});