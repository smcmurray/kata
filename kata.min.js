!function(e,r){"undefined"!=typeof module?module.exports=r():"function"==typeof define&&"object"==typeof define.amd?define(r()):this[e]=r()}("kata",function(){"use strict";function e(r){var n,t,o=/^\s*\(/g,s=0;if(n=o.exec(r)){for(s+=o.lastIndex,r=r.substr(o.lastIndex),t="(",o=/^((?:(?!«|»).)*?)(\(|\))/g;n=o.exec(r);){if(")"===n[2])return{pos:s+o.lastIndex,value:t+n[0]};t+=n[1],s+=o.lastIndex-1,r=r.substr(o.lastIndex-1),(n=e(r))&&(t+=n.value,s+=n.pos,r=r.substr(n.pos))}throw new Error("Parenthetical missing )")}}var r={};return r["%"]=function(r){var n,t,o,s=/^\s*(\w+)/g,i=0;return(n=s.exec(r))&&(t=n[1],i+=s.lastIndex,r=r.substr(s.lastIndex)),(n=e(r))?(o=n.value,i+=n.pos,r=r.substr(n.pos),"»function "+(t?t:"")+o+"{var out='';«"+r+"»}«"):new Error("Template block missing arguments")},r["="]=function(e){return"» out += "+e.replace(/\r|\n/g,"\\n")+"; «"},r["@"]=function(r){var n,t,o;if(!(n=e(r)))throw new Error("Iterate block missing iterable");if(t=n.value,r=r.substr(n.pos),!(n=e(r)))throw new Error("Iterate block missing arguments");return o=n.value,r=r.substr(n.pos),"»"+t+".forEach(function"+o+"{«"+r+"»});«"},r["?"]=function(r){var n,t;if(!(n=e(r)))throw new Error("Condition block missing condition");return t=n.value,r=r.substr(n.pos),"»if "+t+"{«"+r+"»}«"},r[":"]=function(r){var n,t;return(n=e(r))&&(t=n.value,r=r.substr(n.pos)),"»} else "+(t?"if "+t:"")+"{«"+r},r["+"]=function(r){var n,t,o,s=/^\s*(\w+)/g;if(!(n=s.exec(r)))throw new Error("Import block missing alias");if(t=n[1],r=r.substr(s.lastIndex),!(n=e(r)))throw new Error("Import block missing template location");return o=n.value,r=r.substr(n.pos),"»var "+t+" = require"+o+";«"},r[">"]=function(r){var n,t,o,s=/^\s*(\w+)/g;if(!(n=s.exec(r)))throw new Error("Invoke block missing template name");if(t=n[1],r=r.substr(s.lastIndex),!(n=e(r)))throw new Error("Invoke block missing ()");return o=n.value,r=r.substr(n.pos),"»(function(){«"+r+"»out+="+t+o+";}());«"},r["<"]=function(r){var n,t,o,s=/^\s*(\w+)/g;if(!(n=s.exec(r)))throw new Error("Yield block missing template name");if(t=n[1],r=r.substr(s.lastIndex),!(n=e(r)))throw new Error("Yield block missing ()");return o=n.value,r=r.substr(n.pos),"»if (typeof "+t+' ==="function") out+='+t+o+"; else {«"+r+"»}«"},r["!"]=function(e){return"»"+e+"«"},function(e,n){var t={src:!1,plugins:{}};n?Object.keys(t).forEach(function(e){n[e]=n.hasOwnProperty(e)?n[e]:t[e]}):n=n||t,r["#"]=function(e){var r,t=/^\w+/;return(r=t.exec(e))?n.plugins[r[0]]?n.plugins[r[0]](e.substr(t.lastIndex)):void 0:e};for(var o,s,i=/\{\{([%@\?:\+><!#]?)((?:(?!\{\{)[\s\S])*?)([%@\?:\+><!#]?)\}\}/;s=i.exec(e);){var u=s[1]||"=",a=s.index,c=a+s[0].length;if(s[3]&&!(s[3]==u||">"==u&&"<"==s[3]||"<"==u&&">"==s[3]))throw console.error(e.substring(a-5,c+5)),new Error("{{"+s[1]+" at "+(a+2)+" doesn't match "+s[3]+"}} at "+(c-2));try{e=e.substr(0,a)+r[u](s[2])+e.substr(c)}catch(f){throw new Error(f+" in "+u+"block between position "+a+" and position "+c)}}return o=e.replace(/^\s*»|«\s*$/g,"").replace(/«([\s\S]*?)»/g,function(e,r){return"out += '"+r.replace(/\\'/g,"\\$&").replace(/'/g,"\\$&").replace(/\r|\n/g,"\\n")+"';"}),n.src?"(function(name, definition){  'use strict';  if (typeof module != 'undefined') {    module.exports = definition(require);  }  else if (typeof define == 'function' && typeof define.amd == 'object') {    define(definition);  }  else this[name] = definition();}('template', function(require){ return "+o+"}))":new Function("return "+o)()}});