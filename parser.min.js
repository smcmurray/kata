module.exports=function(){function e(e,r){function t(){this.constructor=e}t.prototype=r.prototype,e.prototype=new t}function r(e,r,t,n,i,u){this.message=e,this.expected=r,this.found=t,this.offset=n,this.line=i,this.column=u,this.name="SyntaxError"}function t(e){function t(r){function t(r,t,n){var i,u;for(i=t;n>i;i++)u=e.charAt(i),"\n"===u?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===u||"\u2028"===u||"\u2029"===u?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1)}return Lr!==r&&(Lr>r&&(Lr=0,Mr={line:1,column:1,seenCR:!1}),t(Mr,Lr,r),Lr=r),Mr}function n(e){Nr>Jr||(Jr>Nr&&(Nr=Jr,Or=[]),Or.push(e))}function i(n,i,u){function o(e){var r=1;for(e.sort(function(e,r){return e.description<r.description?-1:e.description>r.description?1:0});r<e.length;)e[r-1]===e[r]?e.splice(r,1):r++}function c(e,r){function t(e){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+r(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+r(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+r(e)})}var n,i,u,o=new Array(e.length);for(u=0;u<e.length;u++)o[u]=e[u].description;return n=e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0],i=r?'"'+t(r)+'"':"end of input","Expected "+n+" but "+i+" found."}var a=t(u),l=u<e.length?e.charAt(u):null;return null!==i&&o(i),new r(null!==n?n:c(i,l),i,l,u,a.line,a.column)}function u(){var e;return e=m()}function o(){var r,t,i;for(r=Jr,t=[],B.test(e.charAt(Jr))?(i=e.charAt(Jr),Jr++):(i=_,0===Qr&&n(P));i!==_;)t.push(i),B.test(e.charAt(Jr))?(i=e.charAt(Jr),Jr++):(i=_,0===Qr&&n(P));return t!==_&&(Kr=r,t=D(t)),r=t}function c(){var r,t,i,u,c;return r=Jr,t=o(),t!==_?(i=Jr,u=Jr,Qr++,92===e.charCodeAt(Jr)?(c=I,Jr++):(c=_,0===Qr&&n(J)),Qr--,c===_?u=H:(Jr=u,u=G),u!==_?(e.substr(Jr,2)===K?(c=K,Jr+=2):(c=_,0===Qr&&n(L)),c!==_?(u=[u,c],i=u):(Jr=i,i=G)):(Jr=i,i=G),i!==_?(t=[t,i],r=t):(Jr=r,r=G)):(Jr=r,r=G),r}function a(){var r,t,i;return r=Jr,t=Jr,Qr++,92===e.charCodeAt(Jr)?(i=I,Jr++):(i=_,0===Qr&&n(J)),Qr--,i===_?t=H:(Jr=t,t=G),t!==_?(e.substr(Jr,2)===M?(i=M,Jr+=2):(i=_,0===Qr&&n(N)),i!==_?(t=[t,i],r=t):(Jr=r,r=G)):(Jr=r,r=G),r}function l(){var r,t,i;return r=c(),r===_&&(r=Jr,Q.test(e.charAt(Jr))?(t=e.charAt(Jr),Jr++):(t=_,0===Qr&&n(T)),t===_&&(t=O),t!==_?(i=a(),i!==_?(t=[t,i],r=t):(Jr=r,r=G)):(Jr=r,r=G)),r}function f(){var r,t,i;return r=Jr,t=Jr,Qr++,i=l(),Qr--,i===_?t=H:(Jr=t,t=G),t!==_?(e.length>Jr?(i=e.charAt(Jr),Jr++):(i=_,0===Qr&&n(V)),i!==_?(Kr=r,t=W(i),r=t):(Jr=r,r=G)):(Jr=r,r=G),r}function s(){var r,t,i,u,c;return r=Jr,t=o(),t!==_?(i=Jr,u=Jr,Qr++,92===e.charCodeAt(Jr)?(c=I,Jr++):(c=_,0===Qr&&n(J)),Qr--,c===_?u=H:(Jr=u,u=G),u!==_?(40===e.charCodeAt(Jr)?(c=X,Jr++):(c=_,0===Qr&&n(Y)),c!==_?(u=[u,c],i=u):(Jr=i,i=G)):(Jr=i,i=G),i!==_?(Kr=r,t=$(),r=t):(Jr=r,r=G)):(Jr=r,r=G),r}function p(){var r,t,i,u,c;return r=Jr,t=o(),t!==_?(i=Jr,u=Jr,Qr++,92===e.charCodeAt(Jr)?(c=I,Jr++):(c=_,0===Qr&&n(J)),Qr--,c===_?u=H:(Jr=u,u=G),u!==_?(41===e.charCodeAt(Jr)?(c=er,Jr++):(c=_,0===Qr&&n(rr)),c!==_?(u=[u,c],i=u):(Jr=i,i=G)):(Jr=i,i=G),i!==_?(Kr=r,t=tr(),r=t):(Jr=r,r=G)):(Jr=r,r=G),r}function h(){var r,t,i,u;return r=Jr,t=Jr,i=Jr,Qr++,u=s(),u===_&&(u=p()),Qr--,u===_?i=H:(Jr=i,i=G),i!==_?(e.length>Jr?(u=e.charAt(Jr),Jr++):(u=_,0===Qr&&n(V)),u!==_?(i=[i,u],t=i):(Jr=t,t=G)):(Jr=t,t=G),t!==_&&(Kr=r,t=nr(t)),r=t}function d(){var e,r,t;if(e=Jr,r=[],t=f(),t!==_)for(;t!==_;)r.push(t),t=f();else r=G;return r!==_&&(Kr=e,r=ir(r)),e=r}function v(){var e,r,t;return e=Jr,r=d(),r!==_?(Kr=Jr,t=ur(r),t=t?H:G,t!==_?(Kr=e,r=or(r),e=r):(Jr=e,e=G)):(Jr=e,e=G),e}function A(){var e,r;return e=Jr,r=v(),r!==_&&(Kr=e,r=cr(r)),e=r}function C(){var r,t,i,u,c,a,f,s;if(r=Jr,t=o(),t!==_){if(i=Jr,40===e.charCodeAt(Jr)?(u=X,Jr++):(u=_,0===Qr&&n(Y)),u!==_){for(c=[],a=Jr,f=Jr,Qr++,s=l(),Qr--,s===_?f=H:(Jr=f,f=G),f!==_?(s=C(),s===_&&(s=h()),s!==_?(Kr=a,f=ar(s),a=f):(Jr=a,a=G)):(Jr=a,a=G);a!==_;)c.push(a),a=Jr,f=Jr,Qr++,s=l(),Qr--,s===_?f=H:(Jr=f,f=G),f!==_?(s=C(),s===_&&(s=h()),s!==_?(Kr=a,f=ar(s),a=f):(Jr=a,a=G)):(Jr=a,a=G);c!==_?(41===e.charCodeAt(Jr)?(a=er,Jr++):(a=_,0===Qr&&n(rr)),a!==_?(u=[u,c,a],i=u):(Jr=i,i=G)):(Jr=i,i=G)}else Jr=i,i=G;i!==_?(Kr=r,t=lr(c),r=t):(Jr=r,r=G)}else Jr=r,r=G;return r}function g(){var r,t,i,u;if(r=Jr,t=o(),t!==_){if(i=[],fr.test(e.charAt(Jr))?(u=e.charAt(Jr),Jr++):(u=_,0===Qr&&n(sr)),u!==_)for(;u!==_;)i.push(u),fr.test(e.charAt(Jr))?(u=e.charAt(Jr),Jr++):(u=_,0===Qr&&n(sr));else i=G;i!==_?(Kr=r,t=pr(i),r=t):(Jr=r,r=G)}else Jr=r,r=G;return r}function y(){var r,t,i,u,c,a,l,f;if(r=Jr,40===e.charCodeAt(Jr)?(t=X,Jr++):(t=_,0===Qr&&n(Y)),t!==_)if(i=g(),i===_&&(i=O),i!==_){for(u=[],c=Jr,a=o(),a!==_?(44===e.charCodeAt(Jr)?(l=hr,Jr++):(l=_,0===Qr&&n(dr)),l!==_?(f=g(),f!==_?(a=[a,l,f],c=a):(Jr=c,c=G)):(Jr=c,c=G)):(Jr=c,c=G);c!==_;)u.push(c),c=Jr,a=o(),a!==_?(44===e.charCodeAt(Jr)?(l=hr,Jr++):(l=_,0===Qr&&n(dr)),l!==_?(f=g(),f!==_?(a=[a,l,f],c=a):(Jr=c,c=G)):(Jr=c,c=G)):(Jr=c,c=G);u!==_?(41===e.charCodeAt(Jr)?(c=er,Jr++):(c=_,0===Qr&&n(rr)),c!==_?(Kr=r,t=vr(i,u),r=t):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;return r}function m(){var r,t,i,u,l,f,s,p,h,d,v;if(r=Jr,t=c(),t!==_)if(37===e.charCodeAt(Jr)?(i=Ar,Jr++):(i=_,0===Qr&&n(Cr)),i!==_)if(u=o(),u!==_)if(l=g(),l===_&&(l=O),l!==_)if(f=y(),f!==_){for(s=[],p=z(),p===_&&(p=R());p!==_;)s.push(p),p=z(),p===_&&(p=R());s!==_?(p=o(),p!==_?(37===e.charCodeAt(Jr)?(h=Ar,Jr++):(h=_,0===Qr&&n(Cr)),h===_&&(h=O),h!==_?(d=a(),d!==_?(v=o(),v!==_?(Kr=r,t=gr(l,f,s),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function x(){var r,t,i,u,l,f,s,p,h;if(r=Jr,t=c(),t!==_)if(64===e.charCodeAt(Jr)?(i=yr,Jr++):(i=_,0===Qr&&n(mr)),i!==_)if(u=C(),u!==_)if(l=y(),l!==_){for(f=[],s=z();s!==_;)f.push(s),s=z();f!==_?(s=o(),s!==_?(64===e.charCodeAt(Jr)?(p=yr,Jr++):(p=_,0===Qr&&n(mr)),p===_&&(p=O),p!==_?(h=a(),h!==_?(Kr=r,t=xr(u,l,f),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function j(){var r,t,i,u,l,f,s,p;return r=Jr,t=c(),t!==_?(43===e.charCodeAt(Jr)?(i=jr,Jr++):(i=_,0===Qr&&n(Fr)),i!==_?(u=g(),u!==_?(l=C(),l!==_?(f=o(),f!==_?(43===e.charCodeAt(Jr)?(s=jr,Jr++):(s=_,0===Qr&&n(Fr)),s===_&&(s=O),s!==_?(p=a(),p!==_?(Kr=r,t=Rr(u,l),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G),r}function F(){var r,t,i,u,l,f,s,p,h,d;if(r=Jr,t=c(),t!==_)if(62===e.charCodeAt(Jr)?(i=wr,Jr++):(i=_,0===Qr&&n(Er)),i!==_)if(u=g(),u!==_)if(l=o(),l!==_)if(f=C(),f!==_){for(s=[],p=m();p!==_;)s.push(p),p=m();s!==_?(p=o(),p!==_?(60===e.charCodeAt(Jr)?(h=br,Jr++):(h=_,0===Qr&&n(kr)),h===_&&(h=O),h!==_?(d=a(),d!==_?(Kr=r,t=zr(u,f,s),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function R(){var r,t,i,u,l,f,s,p;if(r=Jr,t=c(),t!==_)if(60===e.charCodeAt(Jr)?(i=br,Jr++):(i=_,0===Qr&&n(kr)),i!==_)if(u=g(),u!==_){for(l=[],f=z();f!==_;)l.push(f),f=z();l!==_?(f=o(),f!==_?(62===e.charCodeAt(Jr)?(s=wr,Jr++):(s=_,0===Qr&&n(Er)),s===_&&(s=O),s!==_?(p=a(),p!==_?(Kr=r,t=Sr(u,l),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function w(){var r,t,i,u,l,f,s,p;if(r=Jr,t=c(),t!==_)if(63===e.charCodeAt(Jr)?(i=Zr,Jr++):(i=_,0===Qr&&n(_r)),i!==_)if(u=C(),u!==_){for(l=[],f=E(),f===_&&(f=z());f!==_;)l.push(f),f=E(),f===_&&(f=z());l!==_?(f=o(),f!==_?(63===e.charCodeAt(Jr)?(s=Zr,Jr++):(s=_,0===Qr&&n(_r)),s===_&&(s=O),s!==_?(p=a(),p!==_?(Kr=r,t=qr(u,l),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function E(){var r,t,i,u,l,f,s,p;if(r=Jr,t=c(),t!==_)if(58===e.charCodeAt(Jr)?(i=Ur,Jr++):(i=_,0===Qr&&n(Br)),i!==_)if(u=C(),u===_&&(u=O),u!==_){for(l=[],f=z();f!==_;)l.push(f),f=z();l!==_?(f=o(),f!==_?(58===e.charCodeAt(Jr)?(s=Ur,Jr++):(s=_,0===Qr&&n(Br)),s===_&&(s=O),s!==_?(p=a(),p!==_?(Kr=r,t=Pr(u,l),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)}else Jr=r,r=G;else Jr=r,r=G;else Jr=r,r=G;return r}function b(){var e,r,t,n;return e=Jr,r=c(),r!==_?(t=v(),t!==_?(n=a(),n!==_?(Kr=e,r=Dr(t),e=r):(Jr=e,e=G)):(Jr=e,e=G)):(Jr=e,e=G),e}function k(){var r,t,i,u,o,l;return r=Jr,t=c(),t!==_?(33===e.charCodeAt(Jr)?(i=Gr,Jr++):(i=_,0===Qr&&n(Hr)),i!==_?(u=v(),u!==_?(33===e.charCodeAt(Jr)?(o=Gr,Jr++):(o=_,0===Qr&&n(Hr)),o===_&&(o=O),o!==_?(l=a(),l!==_?(Kr=r,t=Ir(u),r=t):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G)):(Jr=r,r=G),r}function z(){var e;return e=m(),e===_&&(e=x(),e===_&&(e=F(),e===_&&(e=j(),e===_&&(e=w(),e===_&&(e=k(),e===_&&(e=b(),e===_&&(e=A()))))))),e}var S,Z=arguments.length>1?arguments[1]:{},_={},q={start:u},U=u,B=/^[ \n\r\t]/,P={type:"class",value:"[ \\n\\r\\t]",description:"[ \\n\\r\\t]"},D=function(e){e.join("")},G=_,H=void 0,I="\\",J={type:"literal",value:"\\",description:'"\\\\"'},K="{{",L={type:"literal",value:"{{",description:'"{{"'},M="}}",N={type:"literal",value:"}}",description:'"}}"'},O=null,Q=/^[%@<>+?:!]/,T={type:"class",value:"[%@<>+?:!]",description:"[%@<>+?:!]"},V={type:"any",description:"any character"},W=function(e){return e},X="(",Y={type:"literal",value:"(",description:'"("'},$=function(){return"("},er=")",rr={type:"literal",value:")",description:'")"'},tr=function(){return")"},nr=function(e){return e[1]},ir=function(e){return e.join("")},ur=function(e){return e.replace(/\s+/,"")},or=function(e){return e},cr=function(e){return'out += "'+e.replace(/[\r\n]/g,"\\n").replace(/"/g,'\\"')+'";\n'},ar=function(e){return e},lr=function(e){return"("+e.join("")+")"},fr=/^[a-zA-Z_]/,sr={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},pr=function(e){return e.join("")},hr=",",dr={type:"literal",value:",",description:'","'},vr=function(e,r){return"("+(e?[e].concat(r.map(function(e){return e[1]})):[])+")"},Ar="%",Cr={type:"literal",value:"%",description:'"%"'},gr=function(e,r,t){var n="function "+(e?e:"")+r+'{\n  var out = "";'+(t.length?t.join(""):"")+"  return out;}\n";return n.kataname=e,n},yr="@",mr={type:"literal",value:"@",description:'"@"'},xr=function(e,r,t){return e+".forEach(function"+r+"{\n"+(t.length?t.join(""):"")+"}\n"},jr="+",Fr={type:"literal",value:"+",description:'"+"'},Rr=function(e,r){return"var "+e+'; if (typeof require === "function"){'+e+" = require("+r+');} else throw new Error("Unable to include template. Please provide a module loader.");\n'},wr=">",Er={type:"literal",value:">",description:'">"'},br="<",kr={type:"literal",value:"<",description:'"<"'},zr=function(e,r,t){return"out += "+e+".bind({"+t.reduce(function(e,r){return r.kataname?(e.push(r.kataname+": "+r),e):e},[]).join(",")+"})"+r+";\n"},Sr=function(e,r){return"if (this."+e+") out+=this."+e+"(); else {"+r.join(",")+"}\n"},Zr="?",_r={type:"literal",value:"?",description:'"?"'},qr=function(e,r){return"if "+e+"{"+(r.length?"\n":"")+r.join("")+"}\n"},Ur=":",Br={type:"literal",value:":",description:'":"'},Pr=function(e,r){return"} else "+(e?"if "+e:"")+"{"+r.join("")},Dr=function(e){return"out += ("+e+").replace(/\"/g, '\\\"');"},Gr="!",Hr={type:"literal",value:"!",description:'"!"'},Ir=function(e){return e},Jr=0,Kr=0,Lr=0,Mr={line:1,column:1,seenCR:!1},Nr=0,Or=[],Qr=0;if("startRule"in Z){if(!(Z.startRule in q))throw new Error("Can't start parsing from rule \""+Z.startRule+'".');U=q[Z.startRule]}if(S=U(),S!==_&&Jr===e.length)return S;throw S!==_&&Jr<e.length&&n({type:"end",description:"end of input"}),i(null,Or,Nr)}return e(r,Error),{SyntaxError:r,parse:t}}();